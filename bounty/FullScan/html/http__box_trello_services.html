<html><body><script src="https://p.trellocdn.com/power-up.min.js"></script><script>!function e(t,r,n){function o(a,u){if(!r[a]){if(!t[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=r[a]={exports:{}};t[a][0].call(c.exports,function(e){var r=t[a][1][e];return o(r||e)},c,c.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,r){"use strict";e("../src/api");var n=e("../src/data-for-url"),o=e("../src/box-button"),i=e("../src/box-error"),a=e("../src/box-urls"),u=e("../src/i18n-settings"),s=(e("xtend"),TrelloPowerUp.Promise),l="./images/icon.svg",c=function(e){var t={};return e.filter(function(e){return!t[e.url]&&(t[e.url]=!0,!0)})};TrelloPowerUp.initialize({"attachment-sections":function(e,t){var r=t.entries;return s.filter(r,function(t){return a.isFolder(e,t.url)}).then(function(t){return 0==t.length?[]:s.map(c(t),function(t){var r=n(e,t.url,t.name).get("title").then(function(t){return t&&!/^https:/.test(t)?t:e.localizeKey("box_folder")}).catch(i,function(){return t.name&&!/^https?:/.test(t.name)?t.name:e.localizeKey("box_folder")});return{id:t.id,claimed:[t],icon:l,title:function(){return r},content:{type:"iframe",url:e.signUrl('./folder.html?ver=1bc1a1e384&',{url:t.url})}}})}).catch(i,function(){return[]})},"attachment-thumbnail":function(e,t){return n(e,t.url,t.name,{thumbnail:!0}).then(function(r){if(!r)throw new i.Unknown;return r.image&&r.image.url||(r.image={url:l,logo:!0}),r.url=t.url,r.openText=e.localizeKey("open_in_box"),r}).catch(i.Unauthorized,i.CouldNotRefresh,function(){return{image:{url:l,logo:!0},url:t.url,title:t.name||t.url,openText:e.localizeKey("open_in_box"),initialize:{type:"iframe",url:e.signUrl(TrelloPowerUp.util.relativeUrl('authorize-link.html?ver=6ec193db87&'))}}}).catch(i,function(){if(a.isBox(t.url))return{image:{url:l,logo:!0},url:t.url,title:t.name||t.url,openText:e.localizeKey("open_in_box")};throw e.NotHandled()})},"card-buttons":function(e){return e.memberCanWriteToModel("card")?[{icon:l,text:e.localizeKey("box"),callback:o}]:[]},"format-url":function(e,t){return n(e,t.url,t.name).then(function(e){return{icon:l,text:e&&e.title?e.title:t.name||t.url}}).catch(i,function(){if(a.isBox(t.url))return{icon:l,text:t.name||t.url};throw e.NotHandled()})}},{targetOrigin:"https://trello.com",localization:u})},{"../src/api":3,"../src/box-button":4,"../src/box-error":5,"../src/box-urls":6,"../src/data-for-url":7,"../src/i18n-settings":8,xtend:2}],2:[function(e,t,r){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}return e}},{}],3:[function(e,t,r){"use strict";var n=e("./box-error"),o=TrelloPowerUp.Promise,i={400:n.BadRequest,401:n.Unauthorized,403:n.Forbidden,404:n.NotFound,405:n.MethodNotAllowed,409:n.Conflict,412:n.PreconditionFailed,429:n.TooManyRequests,500:n.InternalServerError,503:n.Unavailable},a=function(e,t){return new(i[e]||n.Unknown)(t)},u=function(e){return o.all([e.get("organization","private","refresh_token"),e.get("board","private","refresh_token")]).spread(function(e,t){return t||e})},s=function(e){return o.all([e.get("organization","private","access_token"),e.get("board","private","access_token")]).spread(function(e,t){return t||e})},l=function(e,t){if(!t)throw new n.Unauthorized;return new o(function(r,o){var i=new XMLHttpRequest;i.open("POST","./refresh?refresh_token="+t,!0),i.onload=function(){if(200==i.status){var t=JSON.parse(i.responseText);return e.set("organization","private",{refresh_token:t.refresh_token,access_token:t.access_token}).catch(e.NotHandled,function(){return e.set("board","private",{refresh_token:t.refresh_token,access_token:t.access_token})}).then(function(){r(t.access_token)})}o(new n.CouldNotRefresh)},i.send()})},c=function e(t,r,i){return u(t).then(function(u){if(!u)throw new n.Unauthorized;return s(t).then(function(e){if(!e)throw new n.Unauthorized;return new o(function(t,o){Array.isArray(r)&&(r=r.join("/"));var u=new XMLHttpRequest;i=i||{};var s="?"+Object.keys(i).map(function(e){return[e,encodeURIComponent(i[e])].join("=")}).join("&");u.open("GET","./proxy?url="+encodeURIComponent(r+s),!0),u.setRequestHeader("Authorization","Bearer "+e),u.onload=function(){switch(u.status){case 200:case 201:case 202:case 204:try{return t(JSON.parse(u.responseText))}catch(e){return o(new n.InvalidResponse(e.message))}default:return o(a(u.status,u.responseText))}},u.send()})}).catch(n.Unauthorized,function(){return l(t,u).then(function(){return e(t,r,i)})})})},f=function(e,t,r){return s(e).then(function(e){return new o(function(o,i){if(!e)return i(new n.Unauthorized);Array.isArray(t)&&(t=t.join("/"));var u=new XMLHttpRequest;r=r||{};var s="?"+Object.keys(r).map(function(e){return[e,encodeURIComponent(r[e])].join("=")}).join("&");u.open("GET","./proxy?url="+encodeURIComponent(t+s),!0),u.setRequestHeader("Authorization","Bearer "+e),u.responseType="arraybuffer",u.onload=function(){if(200==u.status){var e=new Blob([new Uint8Array(u.response)],{type:"image/png"}),t=new FileReader;t.readAsDataURL(e),t.onloadend=function(){o(t.result)}}else i(202==u.status?new n.ThumbnailNotAvailable:a(u.status,"unable to get preview"))},u.onerror=function(){console.error("Box Power-Up: Failed to fetch thumbnail preview for",t),o()},u.send()})})};t.exports={get:c,getSharedItem:function(e,t,r){return u(e).then(function(i){if(!i)throw new n.Unauthorized;return s(e).then(function(e){if(!e)throw new n.Unauthorized;return new o(function(o,i){var u=new XMLHttpRequest;r=r||{};var s="?"+Object.keys(r).map(function(e){return[e,encodeURIComponent(r[e])].join("=")}).join("&");u.open("GET","./proxy?url="+encodeURIComponent("shared_items"+s),!0),u.setRequestHeader("Authorization","Bearer "+e),u.setRequestHeader("BoxApi","shared_link="+t),u.onload=function(){switch(u.status){case 200:case 201:case 202:case 204:try{return o(JSON.parse(u.responseText))}catch(e){return i(new n.InvalidResponse(e.message))}default:return i(a(u.status,u.responseText))}},u.send()})}).catch(n.Unauthorized,function(){return l(e,i).then(function(){return c(e,t)})})})},getFile:function(e,t){return c(e,["files",t])},getFolder:function(e,t){return c(e,["folders",t])},getThumbnail:function(e,t,r){return f(e,["files",t,"thumbnail.png"],r)}}},{"./box-error":5}],4:[function(e,t,r){"use strict";t.exports=function(e){return e.popup({title:e.localizeKey("box"),url:'./attach.html?ver=9d30a74855&'})}},{}],5:[function(e,t,r){"use strict";t.exports=TrelloPowerUp.util.makeErrorEnum("Box",["BadRequest","Conflict","CouldNotRefresh","Forbidden","MethodNotAllowed","NotFound","PreconditionFailed","InternalServerError","InvalidResponse","ThumbnailNotAvailable","TooManyRequests","Unauthorized","Unavailable","Unknown"])},{}],6:[function(e,t,r){"use strict";var n=e("./api"),o=/^https?:\/\/(?:[\w-]+\.)?(?:app\.)?box\.com\//,i=function(e){return o.test(e)},a=function(e){var t={url:e};if(!i(e))return t;t.isBox=!0;var r=e.replace(o,"").replace(/#.*$/,"").split("?")[0].split("/");return"s"===r[0]?(t.isShareLink=!0,/\?folder=true$/.test(e)?t.isFolder=!0:/\?folder=false$/.test(e)&&(t.isFile=!0)):"files"===r[0]&&(r.length<6&&r.length>3&&"f"===r[2]?(t.isFolder=!0,t.folderId=r[3]):r.length>5&&0===r[5].indexOf("f_")&&(t.isFile=!0,t.fileId=r[5].substring(2))),t};t.exports={parse:a,isBox:i,isFolder:function(e,t){var r=a(t);return!!r.isFolder||!r.isFile&&!!r.isShareLink&&n.getSharedItem(e,t,{fields:"type"}).then(function(e){return"folder"===e.type})}}},{"./api":3}],7:[function(e,t,r){"use strict";var n=e("./api"),o=(e("./box-error"),e("./box-urls")),i=TrelloPowerUp.Promise;t.exports=function(e,t,r,a){return a=a||{},i.try(function(){var r=o.parse(t);if(!r.isBox)throw e.NotHandled("not a box url");if(r.isFile&&r.fileId)return i.all([n.getFile(e,r.fileId,{fields:"id,name,type,created_at,modified_at,modified_by"}),i.try(function(){return a.thumbnail?n.getThumbnail(e,r.fileId,{min_height:256,min_width:256}):null})]).spread(function(e,t){return{image:{url:t,y:"top",size:"contain"},title:e.name,created:Date.parse(e.created_at),modified:Date.parse(e.modified_at),modifiedBy:e.modified_by.name}});if(r.isFolder&&r.folderId)return n.getFolder(e,r.folderId,{fields:"id,name,type,created_at,modified_at,modified_by"}).then(function(e){return{title:e.name,created:Date.parse(e.created_at),modified:Date.parse(e.modified_at),modifiedBy:e.modified_by.name,id:e.id}});if(r.isShareLink){var u=r.url.replace("?folder=true","").replace("?folder=false","");return n.getSharedItem(e,u,{fields:"id,name,type,created_at,modified_at,modified_by"}).then(function(t){return i.try(function(){return"file"==t.type&&a.thumbnail?n.getThumbnail(e,t.id,{min_height:256,min_width:256}):null}).then(function(e){return{image:{url:e,y:"top",size:"contain"},title:t.name,created:Date.parse(t.created_at),modified:Date.parse(t.modified_at),modifiedBy:t.modified_by.name,id:t.id}})})}})}},{"./api":3,"./box-error":5,"./box-urls":6}],8:[function(e,t,r){"use strict";t.exports={defaultLocale:"en",supportedLocales:["cs","de","en","es","fi","fr","hu","it","ja","nb","nl","pl","pt-BR","ru","sv","th","tr","uk","vi","zh-Hans","zh-Hant"],resourceUrl:"./strings/{locale}.json?ver=4168590b0b"}},{}]},{},[1]);</script></body></html>